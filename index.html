<!DOCTYPE html>

<head>

    <title>Australian Prisoners of War | Explore their journey</title>
    <link rel="stylesheet" href="styles/stylesheet.css">
    <link rel="stylesheet" href="styles/modals.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/micromodal/dist/micromodal.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11"></script>

    <noscript>

        <div class="noscript-msg">
            <div class="text">
                Sorry, our page doesn't work without Javascript enabled.
            </div>
        </div>

    </noscript>

</head>

<body>

<div class="abs-bg" id="background-names"></div>

<div id="pg1" class="page pg1">

    <img class="bg" src="Darwin_42.jpg">

    <div id="person_card" onclick="openModal(this)" class="person-card">
        <span class="name" id="name">They were Australians.</span><br>
    </div>

</div>

<div id="modal" class="modal">

    <header id="name"></header>
    <p>
        <span class="name" id="name">They were Australians.</span><br>
        <span id="dob">From 1940 to 1945, over thirty thousand Australians were prisoners of war.</span><br>
        <span id="service">These are their names.</span><br>
        <span id="home">These are their stories.</span><br>
    </p>
    <span onclick="closeModal()" class="x">&#10060;</span>

</div>

<script>

let __JSON_URL__ = "https://nominal-rolls.dva.gov.au/searchAdvancedJSON.json?serviceName=ALL&specialityId=0&branchId=0&categoryId=0&pow=Y&searchType=ADVANCED&conflict=WW2";

let inty, people;
let doDetailWrite = true;
let iterator = 0;

function toTitleCase(str) {
    return str.replace(
        /\w\S*/g,
        function(txt) {
            return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
        }
    );
}

function shuffle(array) {
    var currentIndex = array.length, temporaryValue, randomIndex;

    // While there remain elements to shuffle...
    while (0 !== currentIndex) {
        // Pick a remaining element...
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex -= 1;

        // And swap it with the current element.
        temporaryValue = array[currentIndex];
        array[currentIndex] = array[randomIndex];
        array[randomIndex] = temporaryValue;
    }

    return array;
}

fetch('pows.json').then(response => response.json()).then(data => {
    people = data
    shuffle(people)
    setTimeout(() => {
        inty = setInterval(() => {

            if (doDetailWrite) {

                let person = people[inty % people.length];
                let name = toTitleCase(person.attributes.Name.split(", ").reverse().join(" "));
                let placeofbirth = person.attributes.PlaceOfBirth;

                if (!placeofbirth) {
                    document.getElementById("home").style.visibility = "hidden";
                } else {

                    if (placeofbirth.includes(",")) {
                        placeofbirth = toTitleCase(placeofbirth).split(", ");
                        document.getElementById("home").style.visibility = "unset";
                        placeofbirth[1] = placeofbirth[1].toUpperCase();
                        placeofbirth = placeofbirth.join(", ");
                    } else {
                        placeofbirth = toTitleCase(placeofbirth);
                    }

                    document.getElementById('home').innerText = placeofbirth;
                }

                let serviceName = person.attributes.ServiceName.toLowerCase();
                if (serviceName == "army") {
                    serviceName = "Australian Army"
                } else if (serviceName = "raaf") {
                    serviceName = "Royal Australian Air Force"
                } else if (" " in serviceName) {
                    serviceName = toTitleCase(serviceName);
                } else {
                    serviceName = serviceName.toUpperCase();
                }

                let dateOfBirth = toTitleCase(people[inty % people.length].attributes.DateOfBirth);
                let namespan = document.createElement("span");
                namespan.innerText = name;
                document.getElementById('background-names').appendChild(namespan);
            
                Array.from(document.getElementsByClassName("name")).forEach((e) => {e.innerText = name})
                document.getElementById('dob').innerText = dateOfBirth;
                document.getElementById('service').innerText = serviceName;

            }

            inty++;
            
        }, 500);
    }, 5000)
})

let modal = false;
let itb;
let interval;

function openModal(e) {

    doDetailWrite = false;
    itb = document.getElementById('modal').innerHTML;
    e.style.filter = "blur(5px)";
    document.getElementById('modal').style.top = 0;

    setTimeout(() => {document.getElementById('pg1').onclick = closeModal;}, 1000)

}

function closeModal() {
    doDetailWrite = true;
    console.log("closing modal");
    document.getElementById('person_card').style.filter = "none";
    document.getElementById('modal').style.top = "-40vh";

    setTimeout(() => {document.getElementById('pg1').onclick = null;}, 1000)

}

</script>


</body>